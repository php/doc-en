<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<refentry xmlns="http://docbook.org/ns/docbook" xml:id="memcache.addserver">
 <refnamediv>
  <refname>Memcache::addServer</refname>
  <refname>memcache_add_server</refname>
  <refpurpose>Add a memcached server to connection pool</refpurpose>
 </refnamediv>

 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <type>bool</type><methodname>Memcache::addServer</methodname>
   <methodparam><type>string</type><parameter>host</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>port</parameter><initializer>11211</initializer></methodparam>
   <methodparam choice="opt"><type>bool</type><parameter>persistent</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>weight</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>timeout</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>retry_interval</parameter></methodparam>
   <methodparam choice="opt"><type>bool</type><parameter>status</parameter></methodparam>
   <methodparam choice="opt"><type>callable</type><parameter>failure_callback</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>timeoutms</parameter></methodparam>
  </methodsynopsis>
    <methodsynopsis>
   <type>bool</type><methodname>memcache_add_server</methodname>
   <methodparam><type>Memcache</type><parameter>memcache</parameter></methodparam>
   <methodparam><type>string</type><parameter>host</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>port</parameter><initializer>11211</initializer></methodparam>
   <methodparam choice="opt"><type>bool</type><parameter>persistent</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>weight</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>timeout</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>retry_interval</parameter></methodparam>
   <methodparam choice="opt"><type>bool</type><parameter>status</parameter></methodparam>
   <methodparam choice="opt"><type>callable</type><parameter>failure_callback</parameter></methodparam>
   <methodparam choice="opt"><type>int</type><parameter>timeoutms</parameter></methodparam>
  </methodsynopsis>

  <simpara>
   <function>Memcache::addServer</function> adds a server to the connection pool.
  </simpara>

  <simpara>
   When using this method (as opposed to <function>Memcache::connect</function> and
   <function>Memcache::pconnect</function>) the network connection is not established
   until actually needed. Thus there is no overhead in adding a large number of servers
   to the pool, even though they might not all be used.
  </simpara>

  <simpara>
   Failover may occur at any stage in any of the methods, as long as other
   servers are available the request the user won't notice. Any kind of
   socket or Memcached server level errors (except out-of-memory) may trigger
   the failover. Normal client errors such as adding an existing key will not
   trigger a failover.
  </simpara>

  <note>
   <simpara>
    This function has been added to Memcache version 2.0.0.
   </simpara>
  </note>

 </refsect1>

 <refsect1 role="parameters">
  &reftitle.parameters;
  <variablelist>
   <varlistentry>
    <term><parameter>host</parameter></term>
    <listitem>
     <simpara>
      Point to the host where memcached is listening for connections. This parameter
      may also specify other transports like <literal>unix:///path/to/memcached.sock</literal>
      to use UNIX domain sockets, in this case <parameter>port</parameter> must also
      be set to <literal>0</literal>.
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>port</parameter></term>
    <listitem>
     <simpara>
      Point to the port where memcached is listening for connections.
      Set this
      parameter to <literal>0</literal> when using UNIX domain sockets.
     </simpara>
     <simpara>
      Please note: <parameter>port</parameter> defaults to
      <link linkend="ini.memcache.default-port">memcache.default_port</link>
      if not specified. For this reason it is wise to specify the port
      explicitly in this method call.
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>persistent</parameter></term>
    <listitem>
     <simpara>
      Controls the use of a persistent connection. Default to &true;.
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>weight</parameter></term>
    <listitem>
     <simpara>
      Number of buckets to create for this server which in turn control its
      probability of it being selected. The probability is relative to the
      total weight of all servers.
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>timeout</parameter></term>
    <listitem>
     <simpara>
      Value in seconds which will be used for connecting to the daemon. Think
      twice before changing the default value of 1 second - you can lose all
      the advantages of caching if your connection is too slow.
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>retry_interval</parameter></term>
    <listitem>
     <simpara>
      Controls how often a failed server will be retried, the default value
      is 15 seconds. Setting this parameter to -1 disables automatic retry.
      Neither this nor the <parameter>persistent</parameter> parameter has any
      effect when the extension is loaded dynamically via <function>dl</function>.
     </simpara>
     <simpara>
      Each failed connection struct has its own timeout and before it has expired
      the struct will be skipped when selecting backends to serve a request. Once
      expired the connection will be successfully reconnected or marked as failed
      for another <parameter>retry_interval</parameter> seconds. The typical
      effect is that each web server child will retry the connection about every
      <parameter>retry_interval</parameter> seconds when serving a page.
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>status</parameter></term>
    <listitem>
     <simpara>
      Controls if the server should be flagged as online. Setting this parameter
      to &false; and <parameter>retry_interval</parameter> to -1 allows a failed
      server to be kept in the pool so as not to affect the key distribution
      algorithm. Requests for this server will then failover or fail immediately
      depending on the <parameter>memcache.allow_failover</parameter> setting.
      Default to &true;, meaning the server should be considered online.
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>failure_callback</parameter></term>
    <listitem>
     <simpara>
      Allows the user to specify a callback function to run upon encountering an
      error. The callback is run before failover is attempted. The function takes
      two parameters, the hostname and port of the failed server.
     </simpara>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>timeoutms</parameter></term>
    <listitem>
     <simpara>

     </simpara>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>

 <refsect1 role="returnvalues">
  &reftitle.returnvalues;
  <simpara>
   &return.success;
  </simpara>
 </refsect1>

<refsect1 role="examples">
  &reftitle.examples;
  <example>
   <title><function>Memcache::addServer</function> example</title>
   <programlisting role="php">
<![CDATA[
<?php

/* OO API */

$memcache = new Memcache;
$memcache->addServer('memcache_host', 11211);
$memcache->addServer('memcache_host2', 11211);

/* procedural API */

$memcache_obj = memcache_connect('memcache_host', 11211);
memcache_add_server($memcache_obj, 'memcache_host2', 11211);

?>
]]>
   </programlisting>
  </example>
 </refsect1>

 <refsect1 role="notes">
  &reftitle.notes;
  <warning>
   <simpara>
    When the <parameter>port</parameter> is unspecified, this method defaults to the
    value set of the PHP ini directive
    <link linkend="ini.memcache.default-port">memcache.default_port</link>
    If this value was changed elsewhere in your application it might lead to
    unexpected results: for this reason it is wise to always specify the port
    explicitly in this method call.
   </simpara>
  </warning>
 </refsect1>

 <refsect1 role="seealso">
  &reftitle.seealso;
  <simplelist>
   <member><function>Memcache::connect</function></member>
   <member><function>Memcache::pconnect</function></member>
   <member><function>Memcache::close</function></member>
   <member><function>Memcache::setServerParams</function></member>
   <member><function>Memcache::getServerStatus</function></member>
  </simplelist>
 </refsect1>

</refentry>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
