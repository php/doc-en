<?xml version="1.0" encoding="iso-8859-1"?>
<!-- $Revision: 1.7 $ -->
<!-- splitted from ./en/functions/http.xml, last change in rev 1.2 -->
  <refentry id="function.header">
   <refnamediv>
    <refname>header</refname>
    <refpurpose>向浏览器发送一个 HTTP 头部信息</refpurpose>
   </refnamediv>
   <refsect1>
    <title>描述</title>
     <methodsynopsis>
      <type>int</type><methodname>header</methodname>
      <methodparam><type>string</type><parameter>string</parameter></methodparam>
      <methodparam choice="opt"><type>bool</type><parameter>replace</parameter></methodparam>
      <methodparam choice="opt"><type>int</type><parameter>http_reponse_code</parameter></methodparam>
     </methodsynopsis>
    <para>
     <function>header</function> 函数用来发送一个 <acronym>HTTP</acronym>
     头部信息到客户端的浏览器。有关 <acronym>HTTP</acronym> 头部信息的更多内容参见官方文档
     <ulink url="&spec.http1.1;">HTTP/1.1 specification</ulink>。
    </para>
    <para>
     可选参数 <parameter>replace</parameter>
     用来表示当出现两个相似的头部信息时，是替换前一个相同的头部信息还是增加一个相同的头部信息。默认为替换，如果你将其设为
     &false; 则可以多次发送相同的头部信息。例如:
     <informalexample>
      <programlisting role="php">
<![CDATA[
<?php
header('WWW-Authenticate: Negotiate');
header('WWW-Authenticate: NTLM', FALSE);
?>
]]>
      </programlisting>
     </informalexample>
    </para>
    <para>
     第二个可选参数 <parameter>http_response_code</parameter> 表示 HTTP
     的头部信息的代码。(此参数在PHP 4.3.0 被加入。)
    </para>
    <para>
     头部信息的格式有两种形式。一种情况是以字符 “<literal>HTTP/</literal>” (不区分大小写)开头的，which will be used to figure out the HTTP status
     code to send。例如,如果你if you have configured Apache to
     use a PHP script to handle requests for missing files (using
     the <literal>ErrorDocument</literal> directive), you may want to
     make sure that your script generates the proper status code.
     <informalexample>
      <programlisting role="php">
<![CDATA[
<?php
  header("HTTP/1.0 404 Not Found");
?>
]]>
      </programlisting>
     </informalexample>
     <note>
      <para>
       HTTP 头部信息经常首先被发送到客户端，
       The HTTP status header line will always be the first sent
       to the client, regardless of the actual <function>header</function> 
       call beeing the first or not. The status may be overridden 
       by calling <function>header</function> with a new status line
       at any time unless the HTTP headers have already been sent.
      </para>
     </note>
     <note>
      <para>
       在 PHP 3 中，此函数只在 PHP 以 Apache 的模块化运行的时候有效。你可以使用 <literal>Status</literal>
       来达到相同的效果。
       <informalexample>
        <programlisting role="php">
<![CDATA[
<?php
header("Status: 404 Not Found");
?>
]]>
        </programlisting>
       </informalexample>
      </para>
     </note>
    </para>
    <para>
    第二种特殊情况是以 "Location:" 开头的信息。Not only does 
     it send this header back to the browser, but it also returns a 
     <literal>REDIRECT</literal> (302) status code to the browser unless 
     some <literal>3xx</literal> status code has already been set.
     <informalexample>
      <programlisting role="php">
<![CDATA[
<?php
header("Location: http://www.example.com/"); /* Redirect browser */
exit;                 /* Make sure that code below does 
                         not get executed when we redirect. */
?>
]]>
      </programlisting>
     </informalexample>
    </para>
    <note>
     <para>
      HTTP/1.1 标准需要一个绝对地址的 <acronym>URI</acronym> 做为
      <ulink url="&spec.http1.1;-sec14.html#sec14.30">Location:</ulink>
      的参数, 但有一些客户端支持虚拟的路径。你通常可以使用
      <literal>$_SERVER['HTTP_HOST']</literal>、<literal>$_SERVER['PHP_SELF']</literal>
      及 <function>dirname</function> 函数来自己获取所需要的绝对路径:
      <informalexample>
       <programlisting>
<![CDATA[
<?php
header("Location: http://".$_SERVER['HTTP_HOST']
                      .dirname($_SERVER['PHP_SELF'])
                      ."/".$relative_url);
?>
]]>
       </programlisting>
      </informalexample>
     </para>
    </note>
    <para>
     PHP 脚本通常是动态改变的。可有些客户端或一些代理服务器会把一些浏览过的内容给缓冲起来，这样您更新的脚本就不能被客户端及时的发现，你可以通过发送一些类似下面例子中的头部信息来禁止他们缓存你的网页。
    <informalexample>
      <programlisting role="php">
<![CDATA[
<?php
header("Expires: Mon, 26 Jul 1997 05:00:00 GMT");    // Date in the past
header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT"); 
                                                     // always modified
header("Cache-Control: no-store, no-cache, must-revalidate");  // HTTP/1.1
header("Cache-Control: post-check=0, pre-check=0", false);
header("Pragma: no-cache");                          // HTTP/1.0
?>
]]>
      </programlisting>
     </informalexample>
     <note>
      <para>
       你可能会发现即使你没有把上边的代码全部输出你的网页也没有被缓冲起来。这是因为一些用户在他们的浏览器的设置There are a number of options
       that users may be able to set for their browser that change its
       default caching behavior. By sending the headers above, you should
       override any settings that may otherwise cause the output of your
       script to be cached.
      </para>
      <para>
       另外，<function>session_cache_limiter</function> 和
       <literal>session.cache_limiter</literal> configuration
       setting can be used to automatically generate the correct
       caching-related headers when sessions are being used.
      </para>
     </note>
    </para>
    <para>
     Remember that <function>header</function> must be
     called before any actual output is sent, either by normal HTML
     tags, blank lines in a file, or from PHP. It is a very common
     error to read code with <function>include</function>, or
     <function>require</function>, functions, or another file access
     function, and have spaces or empty lines that are output before
     <function>header</function> is called. The same problem exists
     when using a single PHP/HTML file.
     <informalexample>
      <programlisting role="php">
<![CDATA[

<?php header ("Content-type: audio/x-pn-realaudio"); ?>
// Broken, note the blank line above
]]>
      </programlisting>
     </informalexample>
     <note>
      <para>
       In PHP 4, you can use output buffering to get around this problem,
       with the overhead of all of your output to the browser being buffered
       in the server until you send it. You can do this by calling
       <function>ob_start</function> and <function>ob_end_flush</function>
       in your script, or setting the <literal>output_buffering</literal>
       configuration directive on in your &php.ini; or
       server configuration files.
      </para>
     </note>
    </para>    
    <para>
     If you want the user to be prompted to save the data you are
     sending, such as a generated PDF file, you can use the <ulink
     url="&url.rfc2183;">Content-Disposition</ulink> header to
     supply a recommended filename and force the browser to display the
     save dialog.
     <informalexample>
      <programlisting role="php">
<![CDATA[
<?php
// We'll be outputting a PDF
header("Content-type: application/pdf");

// It will be called downloaded.pdf
header("Content-Disposition: attachment; filename=downloaded.pdf");

// The PDF source is in original.pdf
readfile('original.pdf');
?>
]]>
      </programlisting>
     </informalexample>
     <note>
      <para>
       There is a bug in Microsoft Internet Explorer 4.01 that prevents
       this from working. There is no workaround. There is also a bug
       in Microsoft Internet Explorer 5.5 that interferes with this,
       which can be resolved by upgrading to Service Pack 2 or later.
      </para>
     </note>
    </para>
    <note>
     <simpara>
      If <link linkend="ini.safe-mode">safe mode</link> is enabled the
      uid of the script is added to the <literal>realm</literal> part
      of the <literal>WWW-Authenticate</literal> header if you set
      this header (used for HTTP Authentication).
     </simpara>
    </note>
    <para>
     See also <function>headers_sent</function>,
     <function>setcookie</function>, and the section on 
     <link linkend="features.http-auth">HTTP authentication</link>.
    </para>
   </refsect1>
  </refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"../../../../manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
