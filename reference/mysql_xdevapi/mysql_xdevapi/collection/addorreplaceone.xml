<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->

<refentry xml:id="mysql-xdevapi-collection.addorreplaceone" xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink">
 <refnamediv>
  <refname>Collection::addOrReplaceOne</refname>
  <refpurpose>Add or replace collection document</refpurpose>
 </refnamediv>

 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <modifier>public</modifier> <type>mysql_xdevapi\Result</type><methodname>mysql_xdevapi\Collection::addOrReplaceOne</methodname>
   <methodparam><type>string</type><parameter>id</parameter></methodparam>
   <methodparam><type>string</type><parameter>doc</parameter></methodparam>
  </methodsynopsis>
  <para>
   Add a new document, or replace a document if it already exists.
  </para>
  <para>
   Here are several scenarios for this method:
  </para>
  <itemizedlist>
   <listitem>
    <para>
      If neither the id or any unique key values conflict with any document in the collection, 
      then the document is added.
    </para>
   </listitem>
   <listitem>
    <para>
      If the id does not match any document but one or more unique key values conflict with a 
      document in the collection, then an error is raised.
    </para>
   </listitem>
   <listitem>
    <para>
     If id matches an existing document and no unique keys are defined for the collection, 
     then the document is replaced.
   </para>
   </listitem>
   <listitem>
    <para>
      If id matches an existing document, and either all unique keys in the replacement document 
      match that same document or they don't conflict with any other documents in the collection, 
      then the document is replaced.
    </para>
   </listitem>
   <listitem>
    <para>
      If id matches an existing document and one or more unique keys match a different document 
      from the collection, then an error is raised.
    </para>
   </listitem>
  </itemizedlist>

 </refsect1>

 <refsect1 role="parameters">
  &reftitle.parameters;
  <variablelist>
   <varlistentry>
    <term><parameter>id</parameter></term>
    <listitem>
     <para>
      This is the filter id. If this id or any other field that has a unique index already 
      exists in the collection, then it will update the matching document instead.
     </para>
     <para>
      By default, this id is automatically generated by MySQL Server when the
      record was added, and is referenced as a field named '_id'.
    </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><parameter>doc</parameter></term>
    <listitem>
     <para>
      This is the document to add or replace, which is a JSON string.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>

 <refsect1 role="returnvalues">
  &reftitle.returnvalues;
  <para>
   A Result object.
  </para>
 </refsect1>

 <refsect1 role="examples">
  &reftitle.examples;
  <example>
   <title><function>mysql_xdevapi\Collection::addOrReplaceOne</function> example</title>
   <programlisting role="php">
<![CDATA[
<?php
$session = mysql_xdevapi\getSession("mysqlx://user:password@localhost");
$session->sql("DROP DATABASE IF EXISTS addressbook")->execute();
$session->sql("CREATE DATABASE addressbook")->execute();

$schema = $session->getSchema("addressbook");
$create = $schema->createCollection("people");

$collection = $schema->getCollection("people");

// Using add()
$result = $collection->add('{"name": "Wilma", "age": 23, "job": "Teacher"}')->execute();

// Using addOrReplaceOne()
// Note: we're passing in a known _id value here
$result = $collection->addOrReplaceOne('00005b6b53610000000000000056', '{"name": "Fred",  "age": 21, "job": "Construction"}');

?>
]]>
   </programlisting>
  </example>
 </refsect1>

</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
