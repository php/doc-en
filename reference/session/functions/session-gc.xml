<?xml version="1.0" encoding="utf-8"?>
<!-- $Revision$ -->
<refentry xml:id="function.session-gc" xmlns="http://docbook.org/ns/docbook">
 <refnamediv>
  <refname>session_gc</refname>
  <refpurpose>Perform session data garbage collection</refpurpose>
 </refnamediv>
 <refsect1 role="description">
  &reftitle.description;
  <methodsynopsis>
   <type class="union"><type>int</type><type>false</type></type><methodname>session_gc</methodname>
   <void/>
  </methodsynopsis>
  <para>
   By default, PHP uses <link linkend="ini.session.gc-probability">session.gc_probability</link>
   to run the session garbage collector probabilistically on each
   request. There are some limitations with this approach:
  </para>
  <para>
   <simplelist>
    <member>Low traffic sites may not have their session data deleted within the preferred duration.</member>
    <member>High traffic sites may have the garbage collector run too frequently, performing unnecessary extra work.</member>
    <member>Garbage collection is performed on the user's request, and the user may experience a delay.</member>
   </simplelist>
  </para>
  <para>
   For production systems, it is recommended to disable the
   probability-based garbage collection by setting
   <link linkend="ini.session.gc-probability">session.gc_probability</link> to 0
   and explicitly trigger the garbage collector periodically, for example by using "cron" on
   UNIX-like systems to run a script that calls <function>session_gc</function>.
  </para>
  
  <note>
   <para>
    When calling <function>session_gc</function> from a command-line php script,
    the <link linkend="ini.session.save-path">session.save_path</link> must be set
    to the same value as web requests, and the script must have access and delete
    permissions for the session files. This may be affected by the user the script runs as,
    and container or sandboxing features such as systemd's <literal>PrivateTmp=</literal>
    option.
   </para>
  </note>
 </refsect1>

 <refsect1 role="parameters">
  &reftitle.parameters;
  &no.function.parameters;
 </refsect1>

 <refsect1 role="returnvalues">
  &reftitle.returnvalues;
  <para>
   <function>session_gc</function> returns the number of deleted session
   entries on success, &false; for failure.
  </para>
  <note>
   <para>
    Old session save handlers do not return number of deleted session data, but 
    rather only a success/failure flag. If this is the case, 1 is returned regardless of
    how many session entries are actually deleted.
   </para>
  </note>
 </refsect1>

 <refsect1 role="examples">
  &reftitle.examples;
  <para>
   <example>
    <title><function>session_gc</function> example for task managers like cron</title>
    <programlisting role="php">
<![CDATA[
<?php
// Note: This script should be executed by the same user of web server process.

// Need active session to initialize session data storage access.
session_start();

// Executes GC immediately
session_gc();

// Clean up session ID created by session_start()
session_destroy();
?>
]]>
    </programlisting>
   </example>
   <example>
    <title><function>session_gc</function> example for user accessible script</title>
    <programlisting role="php">
<![CDATA[
<?php
// Note: session_gc() is recommended to be used by a task manager script, but
// it may be used as follows.

// Used for last GC time check
$gc_time = '/tmp/php_session_last_gc';
$gc_period = 1800;

session_start();
// Execute GC only when GC period elapsed. 
// i.e. Calling session_gc() every request is waste of resources. 
if (file_exists($gc_time)) {
    if (filemtime($gc_time) < time() - $gc_period) {
        session_gc();
        touch($gc_time);
    }
} else {
    touch($gc_time);
}
?>
]]>
    </programlisting>
   </example>
  </para>
 </refsect1>

 <refsect1 role="seealso">
  &reftitle.seealso;
  <para>
   <simplelist>
    <member><function>session_start</function></member>
    <member><function>session_destroy</function></member>
    <member><link linkend="ini.session.gc-probability">session.gc_probability</link></member>
   </simplelist>
  </para>
 </refsect1>
</refentry>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
indent-tabs-mode:nil
sgml-parent-document:nil
sgml-default-dtd-file:"~/.phpdoc/manual.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
vim600: syn=xml fen fdm=syntax fdl=2 si
vim: et tw=78 syn=sgml
vi: ts=1 sw=1
-->
